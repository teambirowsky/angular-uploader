angular.module("angular.upload.controllers",[]).controller("uploadController",["$scope",function(a){function b(b,c){var d=new FileReader;d.onerror=function(a){switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:alert("File Not Found!");break;case a.target.error.NOT_READABLE_ERR:alert("File is not readable");break;case a.target.error.ABORT_ERR:break;default:alert("An error occurred reading this file.")}},d.onprogress=function(a){if(a.lengthComputable){var c=Math.round(a.loaded/a.total*100);b.progress=c}},d.onabort=function(a){alert("File read cancelled")},d.onloadstart=function(a){b.error=!1,b.uploading=!0,b.finished=!1,b.progress=0},d.onload=function(c){b.finished=!0,b.uploading=!1,b.uploadFeedback=a.uploadFeedback({success:!0,result:c.target.result,file:b.fileObj}),a.$apply()},a.$upload.config.readAsText?d.readAsText(b.fileObj):d.readAsDataURL(b.fileObj)}function c(a,b){for(var c=!1,d=0;d<a.length;d++){var e=a[d];e.name==b.name&&e.size==b.size&&(c=!0)}return c}function d(b,c){var d=new FormData;d.append("file",b.fileObj),b.error=!1,b.uploading=!0,b.finished=!1,b.progress=0;var e=$.ajax({type:"POST",url:c.target,data:d,success:function(c){b.finished=!0,b.uploading=!1,a.$apply()},error:function(){b.error=!0,b.uploading=!1,a.$apply()},xhr:function(){var c=$.ajaxSettings.xhr();return c.upload&&c.upload.addEventListener("progress",function(c){var d=0,e=c.loaded||c.position,f=c.total;c.lengthComputable&&(d=Math.ceil(e/f*100)),b.progress=d,a.$apply()},!1),c},processData:!1,contentType:!1});d.abort=function(){e.abort()}}a.$upload={},a.$upload.config={},a.$upload.files=[],a.$upload.prepareFiles=function(e){a.$upload.extError=null,a.$upload.msg=null;for(var f=0;f<e.length;f++){var g=e[f],h={name:g.name,size:g.size,progress:0,fileObj:g,retry:function(){d(this,a.$upload.config)},ext:a.$upload.getExtension(g.name)};if(c(a.$upload.files,h)&&0!=a.$upload.config.checkDuplicate)return a.uploadFeedback({success:!1,errorMsg:"File already added"}),void(a.$upload.msg="File already added");a.$upload.checkValidExtension(h.ext)?(a.$upload.files.push(h),!a.$upload.config.target||a.$upload.config.client?b(a.$upload.files[a.$upload.files.length-1],a.$upload.config):d(a.$upload.files[a.$upload.files.length-1],a.$upload.config)):(a.uploadFeedback({success:!1,errorMsg:"File extension not allowed! Allowed extensions: "+a.$upload.config.validExt.join(", ")}),a.$upload.extError="File extension not allowed! Allowed extensions: "+a.$upload.config.validExt.join(", "))}},a.$upload.setConfig=function(b){a.$upload.config=b},a.$upload.checkValidExtension=function(b){return a.$upload.config.validExt&&0!=a.$upload.config.validExt.length?a.$upload.config.validExt.indexOf(b)>-1:!0},a.$upload.getExtension=function(a){return a.split(".")[a.split(".").length-1]}}]),angular.module("angular.upload.directives",[]).directive("uploadInit",function(){function a(a,b,c){return function(a,b,d){a.$upload.setConfig(a.uploadInit),c(a,function(a){b.append(a)})}}return{restrict:"A",transclude:!0,scope:{uploadInit:"=",uploadFeedback:"=?",$upload:"=?uploadData"},compile:a,controller:"uploadController"}}).directive("uploadDrop",function(){function a(a,b,c){return function(a,b,d){b.on("dragenter",function(c){c.preventDefault(),c.stopPropagation(),b.attr("style",a.$upload.config.dragStyle||"")}),b.on("dragover",function(c){c.preventDefault(),c.stopPropagation(),b.attr("style",a.$upload.config.dragStyle||"")}),b.on("dragleave",function(a){a.preventDefault(),a.stopPropagation(),b.attr("style","")}),b.on("drop",function(c){c.preventDefault(),c.stopPropagation();var d=c.originalEvent.dataTransfer.files;a.$upload.prepareFiles(d),a.$apply(),b.attr("style","")}),b.on("dragover",function(a){a.preventDefault(),a.stopPropagation()}),c(a,function(a){b.append(a)})}}return{restrict:"A",transclude:!0,compile:a}}).directive("uploadBtn",function(){function a(a,b){b.click(function(a){setTimeout(function(){b.find("input").trigger("click")},0)}),b.find("input").on("change",function(b){b.target.files.length>0&&a.$upload.prepareFiles(b.target.files),a.$apply()})}return{restrict:"A",transclude:!0,link:a,templateUrl:"modules/upload/views/upload-btn.html"}}),angular.module("angular.upload",["angular.upload.controllers","angular.upload.directives"]),angular.module("angular.upload").run(["$templateCache",function(a){"use strict";a.put("modules/upload/views/upload-btn.html",'<div>\r\n  <ng-transclude></ng-transclude>\r\n  <input type="file" style="display: none;">\r\n</div>\r\n')}]);